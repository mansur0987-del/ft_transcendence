'use strict';

const nopt = require('nopt');
const parsed = nopt({
    server: Boolean,
    client: Boolean,
}, {}, process.argv, 2);

// True if the file is run as a script, else we've been require'd in as a module
if (require.main === module) {
    if (parsed.server) {
        const server = require('./src/server');
        const register = server(8000);

        register('int', { args: [{ name: 'integer', type: 'Number' }], fn: x => x * 2 });
        register('float', { args: [{ name: 'float', type: 'Number' }], fn: x => x * 2 });
        register('foo.string', { args: [{ name: 'string', type: 'String' }], fn: x => x.length });
    } else {
        require('./src/client').connect('localhost', '8000').then(schema => Promise.all([
            schema.float(3.141),
            schema.int(42),
            schema.foo.string('hello, world!'),
        ])).then(result => {
            console.log(result);
        }).catch(result => {
            console.log(result);
        });
    }
} else {
    module.exports = {
        server: require('./src/server'),
        client: require('./src/client'),
    };
}
